<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head th:replace="_fragments/header :: head">
    <title>ÌöåÏõê Í¥ÄÎ¶¨ - CLD4 Archive</title>
  </head>
  <body class="d-flex flex-column min-vh-100">
    <div th:replace="_fragments/header :: header"></div>

    <main class="container mt-4 flex-grow-1">
      <div class="row">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="h2 mb-0"><i class="bi bi-people"></i> ÌöåÏõê Í¥ÄÎ¶¨</h1>
            <form class="d-flex" method="get" th:action="@{/users}">
              <input type="hidden" name="status" th:value="${activeStatus}" />
              <input type="hidden" name="sort" th:value="${sort}" />
              <input type="hidden" name="order" th:value="${order}" />
              <input
                class="form-control me-2"
                type="search"
                placeholder="Ïù¥Î¶Ñ/Ïù¥Î©îÏùº Í≤ÄÏÉâ"
                name="q"
                th:value="${q}"
              />
              <button class="btn btn-outline-primary" type="submit">
                <i class="bi bi-search"></i>
              </button>
            </form>
          </div>
          <ul class="nav nav-tabs mb-4">
            <li class="nav-item">
              <a
                class="nav-link"
                th:classappend="${activeStatus == 'all'} ? ' active'"
                th:href="@{/users(q=${q}, sort=${sort}, order=${order})}"
              >
                Ï†ÑÏ≤¥
                <span class="badge bg-secondary ms-1" th:text="${countAll}"
                  >0</span
                >
              </a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                th:classappend="${activeStatus == 'approved'} ? ' active'"
                th:href="@{/users(status='approved', q=${q}, sort=${sort}, order=${order})}"
              >
                ÏäπÏù∏
                <span class="badge bg-secondary ms-1" th:text="${countApproved}"
                  >0</span
                >
              </a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                th:classappend="${activeStatus == 'pending'} ? ' active'"
                th:href="@{/users(status='pending', q=${q}, sort=${sort}, order=${order})}"
              >
                ÎåÄÍ∏∞
                <span class="badge bg-secondary ms-1" th:text="${countPending}"
                  >0</span
                >
              </a>
            </li>
          </ul>

          <div
            th:if="${users.empty}"
            class="alert alert-light text-center border"
          >
            <i class="bi bi-info-circle"></i> Îì±Î°ùÎêú ÌöåÏõêÏù¥ ÏóÜÏäµÎãàÎã§.
          </div>

          <div th:unless="${users.empty}" class="card">
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover mb-0 align-middle">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Ïù¥Î¶Ñ</th>
                      <th scope="col">Ïù¥Î©îÏùº</th>
                      <th scope="col">Ïó≠Ìï†</th>
                      <th scope="col">ÏäπÏù∏</th>
                      <th scope="col">
                        Í∞ÄÏûÖÏùº
                        <a
                          th:href="@{/users(status=${activeStatus}, q=${q}, sort='createdAt', order=${order=='asc'?'desc':'asc'})}"
                          class="ms-1 text-decoration-none"
                        >
                          <i
                            class="bi"
                            th:classappend="${sort=='createdAt' and order=='asc'} ? ' bi-caret-up-fill' : ' bi-caret-down-fill'"
                          ></i>
                        </a>
                      </th>
                      <th scope="col" class="text-center">Í¥ÄÎ¶¨</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      th:each="user : ${users}"
                      th:classappend="${user.role.name() != 'ADMIN' and !user.approved} ? ' row-pending'"
                    >
                      <td>
                        <a
                          th:href="@{'/users/detail/' + ${user.id}}"
                          class="text-decoration-none"
                        >
                          <strong th:text="${user.id}">#1</strong>
                        </a>
                      </td>
                      <td>
                        <div class="d-flex align-items-center">
                          <i class="bi bi-person-circle me-2 text-muted"></i>
                          <span th:text="${user.name}">Ïù¥Î¶Ñ</span>
                        </div>
                      </td>
                      <td>
                        <div class="d-flex align-items-center">
                          <i class="bi bi-envelope me-2 text-muted"></i>
                          <span th:text="${user.email}">Ïù¥Î©îÏùº</span>
                        </div>
                      </td>
                      <td>
                        <span th:switch="${user.role.name()}" class="badge">
                          <span th:case="'ADMIN'" class="badge badge-outline"
                            >üëë Í¥ÄÎ¶¨Ïûê</span
                          >
                          <span th:case="'TEACHER'" class="badge badge-outline"
                            >üë®‚Äçüè´ Í∞ïÏÇ¨</span
                          >
                          <span th:case="'STUDENT'" class="badge badge-outline"
                            >üë®‚Äçüéì ÌõàÎ†®ÏÉù</span
                          >
                          <span
                            th:case="*"
                            class="badge badge-outline"
                            th:text="${user.role}"
                            >Ïó≠Ìï†</span
                          >
                        </span>
                      </td>
                      <td>
                        <span
                          th:if="${user.role.name() == 'ADMIN'}"
                          class="badge badge-outline"
                          >-</span
                        >
                        <span th:if="${user.role.name() != 'ADMIN'}">
                          <span
                            th:if="${user.approved}"
                            class="badge badge-outline-primary"
                            >ÏäπÏù∏</span
                          >
                          <span
                            th:unless="${user.approved}"
                            class="badge badge-outline"
                            >ÎåÄÍ∏∞</span
                          >
                        </span>
                      </td>
                      <td>
                        <small class="text-muted">
                          <i class="bi bi-calendar3"></i>
                          <span
                            th:text="${#temporals.format(user.createdAt, 'yyyy-MM-dd HH:mm')}"
                            >Í∞ÄÏûÖÏùº</span
                          >
                        </small>
                      </td>
                      <td class="text-center">
                        <div class="btn-group" role="group">
                          <a
                            th:href="@{/users/{id}(id=${user.id})}"
                            class="btn btn-sm btn-outline-primary"
                            title="ÏÉÅÏÑ∏Î≥¥Í∏∞"
                          >
                            <i class="bi bi-eye"></i>
                          </a>
                          <a
                            th:href="@{'/users/edit/' + ${user.id}}"
                            class="btn btn-sm btn-outline-primary"
                            title="ÏàòÏ†ï"
                          >
                            <i class="bi bi-pencil"></i>
                          </a>
                          <form
                            th:action="@{'/users/approve/' + ${user.id}}"
                            method="post"
                            th:if="${user.role.name() != 'ADMIN' and !user.approved}"
                          >
                            <button
                              type="submit"
                              class="btn btn-sm btn-primary"
                              title="ÏäπÏù∏"
                            >
                              <i class="bi bi-check2-circle"></i>
                            </button>
                          </form>
                          <a
                            th:href="@{'/users/delete/' + ${user.id}}"
                            class="btn btn-sm btn-outline-primary"
                            title="ÏÇ≠Ï†ú"
                            onclick="return confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?');"
                          >
                            <i class="bi bi-trash"></i>
                          </a>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div th:replace="_fragments/footer :: footer"></div>
    <div th:replace="_fragments/header :: scripts"></div>
  </body>
</html>
